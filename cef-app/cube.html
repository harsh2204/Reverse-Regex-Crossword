<html>
   <head>
      <title>My first Three.js app</title>
      <style>
      canvas { width: 100%; height: 100% }
      </style>
      <!-- <script src="js/three.min.js"></script> FIX ME! -->
      <script src="https://threejs.org/build/three.min.js"></script>
      <!-- <script src="js/OrbitControls.js"></script> FIX ME! -->
      <script src="https://threejs.org/examples/js/controls/OrbitControls.js"></script>
   </head>
   <body>      

      <script>  

         function loadPuzzle() {
          var grid = window.puzzle;

          var renderer = new THREE.WebGLRenderer();
          renderer.setSize(window.innerWidth, window.innerHeight);
          document.body.appendChild(renderer.domElement);

          var scene = new THREE.Scene();

          var camera = new THREE.PerspectiveCamera(75,window.innerWidth/window.innerHeight, 1,10000);

          var controls = new THREE.OrbitControls( camera, renderer.domElement );

          class Cube{

          constructor(scene, letter, x, y, z) {
            this.letter = letter;
            this.size = 10;
            this.buffer = 2;

            this.x = x * this.size;
            this.y = y * this.size;
            this.z = z * this.size;

            this.geometry = new THREE.BoxGeometry(this.size-this.buffer, this.size-this.buffer, this.size-this.buffer);
            this.material = new THREE.MeshBasicMaterial({color: 0xc70039});
            this.cube = new THREE.Mesh(this.geometry, this.material);
            this.cube.material.transparent = true;
            this.cube.material.opacity = 0.5;
            
            this.cube.position.set(this.x, this.y, this.z);
            scene.add(this.cube);
            
            this.edges = new THREE.EdgesGeometry( this.geometry );
            this.line = new THREE.LineSegments( this.edges,
            new THREE.LineBasicMaterial( { color: 0xffffff, linewidth:2 } ) );
            this.line.position.set(this.x, this.y, this.z);
            
            scene.add(this.line);
            
          }

          }
          var cubes = [];
          console.log(grid);
          for ( var i = 0; i < grid.length; i++ ){
            if ( Array.isArray( grid[i] )){
              var Y_array = grid[i];
              
              for ( var j = 0; j < Y_array.length; j++){

              if ( Array.isArray( Y_array[j] )){
                var X_array = Y_array[j];
                for ( var k = 0; k < X_array.length; k++){
                  console.log(i+" "+j+" "+k)
                  var cube = new Cube(scene, X_array[k], i, j, k);
                  cubes.push(cube);
                }
                
              }else{
                // Use Z coord as 0
                var cube = new Cube(scene, Y_array[j], i, j, 0);
                cubes.push(cube);
              }
              }
            }else{
              var cube = new Cube(scene, grid[i], i, 0, 0);
              cubes.push(cube);
            }
          }
          window.cubes = cubes;

          camera.position.z = 100;

          controls.update();

          function render() {
            requestAnimationFrame(render);
            controls.update();

            renderer.render(scene, camera);
          }
          render();
         }
      </script>
      <script>

        function fetch_puzzle(data) {
          window.puzzle = JSON.parse(data);
          console.log("Value sent from Python:"+window.puzzle);
          loadPuzzle();
      }

      </script>
   </body>
</html>